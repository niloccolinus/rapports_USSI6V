% !TEX options=-synctex=-1
\documentclass[a4paper,12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}
\usepackage{amsmath,amssymb}
\usepackage{xcolor}
\usepackage{geometry}
\usepackage{soul}
\usepackage{graphicx} % pour inclure des images
\usepackage{animate}

\geometry{
  a4paper,
  total={170mm,257mm},
  left=20mm,
  top=20mm,
}

\usepackage{extensionCours}

\title{TP 4 - Espace}
\author{Groupe 2 \\* Colin, Henri, Leïla, Loïs}

\begin{document}
\maketitle

\sectionExercice{Théorie}
\label{exo:theorique}

Soit un objet défini dans son repère local. On vous fournit les transformations suivantes à appliquer dans l'ordre indiqué :

\begin{itemize}
  \item Une translation par le vecteur \((a, b, c) = (3, -2, 5)\).
  \item Une rotation autour de l'axe \(z\) de \(\theta = \frac{\pi}{3}\) (60°).
\end{itemize}

\begin{enumerate}
  \item Écrivez individuellement la matrice de translation \(T\) et la matrice de rotation \(R_z\) en coordonnées homogènes (matrices \(4 \times 4\)).

    La matrice de translation \(T\) par le vecteur \((a, b, c) = (3, -2, 5)\) en coordonnées homogènes est : 

    \[
    T = 
    \begin{pmatrix}
    1 & 0 & 0 & a \\
    0 & 1 & 0 & b \\
    0 & 0 & 1 & c \\
    0 & 0 & 0 & 1
    \end{pmatrix}
    \]

    Soit :

    \[
    \boxed{
    T = 
    \begin{pmatrix}
    1 & 0 & 0 & 3 \\
    0 & 1 & 0 & -2 \\
    0 & 0 & 1 & 5 \\
    0 & 0 & 0 & 1
    \end{pmatrix}
    }
    \]

    La matrice de rotation \(R_z\) autour de l'axe \(z\) de \(\theta = \frac{\pi}{3}\) en coordonnées homogènes est : 

    \[
    R_z = 
    \begin{pmatrix}
    \cos(\theta) & -\sin(\theta) & 0 & 0 \\
    \sin(\theta) & \cos(\theta) & 0 & 0 \\
    0 & 0 & 1 & 0 \\
    0 & 0 & 0 & 1
    \end{pmatrix}
    \]

    Soit :

    \[
    \boxed{
    R_z = 
    \begin{pmatrix}
    \cos(\frac{\pi}{3}) & -\sin(\frac{\pi}{3}) & 0 & 0 \\
    \sin(\frac{\pi}{3}) & \cos(\frac{\pi}{3}) & 0 & 0 \\
    0 & 0 & 1 & 0 \\
    0 & 0 & 0 & 1
    \end{pmatrix} 
    =
    \begin{pmatrix}
    \frac{1}{2} & -\frac{\sqrt{3}}{2} & 0 & 0 \\
    \frac{\sqrt{3}}{2} & \frac{1}{2} & 0 & 0 \\
    0 & 0 & 1 & 0 \\
    0 & 0 & 0 & 1
    \end{pmatrix} 
    }
    \]

    \newpage

  \item Calculez la matrice de transformation globale \(M\) en composant ces matrices dans l'ordre approprié.

    On obtient par produit $T R_z$ la matrice de transformation globale \(M\) :

    \[
    \boxed{
    M = T R_z =
    \begin{pmatrix}
    \frac{1}{2} & -\frac{\sqrt{3}}{2} & 0 & 3 \\
    \frac{\sqrt{3}}{2} & \frac{1}{2} & 0 & -2 \\
    0 & 0 & 1 & 5 \\
    0 & 0 & 0 & 1
    \end{pmatrix}
    } 
    \]


  \item Appliquez \(M\) à un sommet local 
  \[
  V_{\text{local}} = \begin{pmatrix} 1 \\ 0 \\ 0 \\ 1 \end{pmatrix}
  \]
  pour déterminer sa position dans l'espace monde. \newline

    On obtient les coordonnées mondes par le produit $M V_{\text{local}}$ :

    \[
    V_{\text{monde}} = M V_{\text{local}}
    \]

    \[
    V_{\text{monde}} = 
      \begin{pmatrix}
      \frac{1}{2} & -\frac{\sqrt{3}}{2} & 0 & 3 \\
      \frac{\sqrt{3}}{2} & \frac{1}{2} & 0 & -2 \\
      0 & 0 & 1 & 5 \\
      0 & 0 & 0 & 1
      \end{pmatrix} 
      \times
      \begin{pmatrix} 1 \\ 0 \\ 0 \\ 1 \end{pmatrix}
    \]

    \[
    \boxed{
    V_{\text{monde}} = 
      \begin{pmatrix} \frac{7}{2} \\ -\frac{4 +\sqrt{3}}{2} \\ 5 \\ 1 \end{pmatrix}
    }
    \] \newline

  \item Déterminer le déterminant de la matrice $M$. \newline

    Pour calculer le déterminant d’une matrice \(4 \times 4\), on utilise la méthode de Laplace (développement par cofacteurs), qui consiste à développer le déterminant suivant la première ligne.

    Soit la matrice suivante :

    \[
    \begin{pmatrix}
    a & b & c & d \\
    e & f & g & h \\
    i & j & k & l \\
    m & n & o & p
    \end{pmatrix}
    \]

    Son déterminant se calcule par :

    \[
    \det =
    a \times 
    \begin{pmatrix}
    f & g & h \\
    j & k & l \\
    n & o & p
    \end{pmatrix}
    - b \times 
    \begin{pmatrix}
    e & g & h \\
    i & k & l \\
    m & o & p
    \end{pmatrix}
    + c \times 
    \begin{pmatrix}
    e & f & h \\
    i & j & l \\
    m & n & p
    \end{pmatrix}
    - d \times 
    \begin{pmatrix}
    e & f & g \\
    i & j & k \\
    m & n & o
    \end{pmatrix}
    \]

    Dans notre cas, la matrice \(M\) est :

    \newpage

    \[
    \begin{pmatrix}
    \frac{1}{2} & -\frac{\sqrt{3}}{2} & 0 & 3 \\
    \frac{\sqrt{3}}{2} & \frac{1}{2} & 0 & -2 \\
    0 & 0 & 1 & 5 \\
    0 & 0 & 0 & 1
    \end{pmatrix}
    \]

    On identifie et on applique la formule :

    \[
    \det(M) =
    \frac{1}{2} \times 
    \begin{pmatrix}
    \frac{1}{2} & 0 & -2 \\
    0 & 1 & 5 \\
    0 & 0 & 1
    \end{pmatrix}
    - \left(-\frac{\sqrt{3}}{2}\right) \times 
    \begin{pmatrix}
    \frac{\sqrt{3}}{2} & 0 & -2 \\
    0 & 1 & 5 \\
    0 & 0 & 1
    \end{pmatrix}
    + 0 
    - 3 \times 
    \begin{pmatrix}
    \frac{\sqrt{3}}{2} & \frac{1}{2} & 0 \\
    0 & 0 & 1 \\
    0 & 0 & 0
    \end{pmatrix}
    \]

    On obtient :

    \[
    \det(M) = \frac{1}{2} \times \frac{1}{2} + \frac{\sqrt{3}}{2} \times \frac{\sqrt{3}}{2} = \frac{1}{4} + \frac{3}{4}
    \]

    \[
    \boxed{
    \det(M) = 1
    }
    \] \newline

    \textbf{Conclusion :} le déterminant de la matrice \(M\) est \(1\). La transformation conserve les volumes. \newline

  \item On applique à l'objet \(H(1.5)\) une homothétie uniforme de facteur $1.5$. Déterminer la nouvelle matrice $M$ de transformation globale. \newline

    La matrice d’homothétie uniforme de facteur \(1.5\) en coordonnées homogènes est :

    \[
    H = 
    \begin{pmatrix}
    1.5 & 0 & 0 & 0 \\
    0 & 1.5 & 0 & 0 \\
    0 & 0 & 1.5 & 0 \\
    0 & 0 & 0 & 1
    \end{pmatrix}
    \]

    La nouvelle matrice globale devient donc :

    \[
    M' = T \times R_z \times H
    \]

    \[
    \boxed{
    M' =
    \begin{pmatrix}
    \frac{3}{4} & -\frac{3\sqrt{3}}{4} & 0 & 0 \\
    \frac{3\sqrt{3}}{4} & \frac{3}{4} & 0 & -2 \\
    0 & 0 & \frac{3}{2} & 5 \\
    0 & 0 & 0 & 1
    \end{pmatrix}
    }
    \] \newline

  \item Déterminer le déterminant de la matrice $M$, en déduire une interprétation géométrique du déterminant. \newline

    On applique la même méthode que pour la matrice \(M\), en développant selon la première ligne de :

    \[
    M' = 
    \begin{pmatrix}
    \frac{3}{4} & -\frac{3\sqrt{3}}{4} & 0 & 0 \\
    \frac{3\sqrt{3}}{4} & \frac{3}{4} & 0 & -2 \\
    0 & 0 & \frac{3}{2} & 5 \\
    0 & 0 & 0 & 1
    \end{pmatrix}
    \]

    On effectue les calculs :

    \[
    \det(M') =
    \frac{3}{4} \times 
    \begin{pmatrix}
    \frac{3}{4} & 0 & -2 \\
    0 & \frac{3}{2} & 5 \\
    0 & 0 & 1
    \end{pmatrix}
    + \frac{3\sqrt{3}}{4} \times 
    \begin{pmatrix}
    \frac{3\sqrt{3}}{4} & 0 & -2 \\
    0 & \frac{3}{2} & 5 \\
    0 & 0 & 1
    \end{pmatrix}
    \]

    \[
    = \frac{3}{4} \times \frac{9}{8} + \frac{3\sqrt{3}}{4} \times \frac{9\sqrt{3}}{8}
    \]

    \[
    = \frac{27}{32} + \frac{27}{32} = \frac{54}{32} = \frac{27}{16} 
    \]

    \[
    \boxed{
    \det(M') = \frac{27}{8}
    }
    \] \newline

    \textbf{Conclusion :} le déterminant de la matrice \(M'\) est \(\frac{27}{8} = 3.375\).  
    L’homothétie de facteur \(1{,}5\) multiplie le volume par \(1.5^3 = 3.375\). \newline

  \item Soit les coordonnées monde d'un sommet de l'objet :  
  \[
  W = \begin{pmatrix} 4 \\ -4 \\ 5 \\ 1 \end{pmatrix}
  \]
  déterminer ses coordonnées locales. \newline

    On obtient les coordonnées mondes par le produit $M W$ :

      \[
      V_{\text{local}} = M^{-1} W
      \]

    où $M^{-1}$ est l'inverse de la matrice globale $M$. \newline

    Pour calculer $M^{-1}$, on applique la méthode du pivot de Gauss sur la matrice augmentée $[M \mid I_4]$:

      \[
      \left[
      \begin{array}{cccc|cccc}
      \frac{1}{2} & -\frac{\sqrt{3}}{2} & 0 & 3 & 1 & 0 & 0 & 0 \\
      \frac{\sqrt{3}}{2} & \frac{1}{2} & 0 & -2 & 0 & 1 & 0 & 0 \\
      0 & 0 & 1 & 5 & 0 & 0 & 1 & 0 \\
      0 & 0 & 0 & 1 & 0 & 0 & 0 & 1 \\
      \end{array}
      \right]
      \]

    On obtient :

      \[
      M^{-1} =
      \begin{pmatrix}
      \frac{1}{2} & \frac{\sqrt{3}}{2} & 0 & -\frac{3}{2} + \sqrt{3} \\
      -\frac{\sqrt{3}}{2} & \frac{1}{2} & 0 & \frac{3\sqrt{3}}{2} + 1 \\
      0 & 0 & 1 & -5 \\
      0 & 0 & 0 & 1
      \end{pmatrix}
      \] \newline

    On effectue ensuite le produit matriciel:

      \[
      V_{\text{local}} = 
      \begin{pmatrix}
      \frac{1}{2} & \frac{\sqrt{3}}{2} & 0 & -\frac{3}{2} + \sqrt{3} \\
      -\frac{\sqrt{3}}{2} & \frac{1}{2} & 0 & \frac{3\sqrt{3}}{2} + 1 \\
      0 & 0 & 1 & -5 \\
      0 & 0 & 0 & 1
      \end{pmatrix}
      \begin{pmatrix}
      4 \\ -4 \\ 5 \\ 1
      \end{pmatrix}
      \]

      \[
      \boxed{
      V_{\text{local}} =
      \begin{pmatrix}
      \frac{1}{2} - \sqrt{3} \\
      -1 - \frac{\sqrt{3}}{2} \\
      0 \\
      1
      \end{pmatrix}
      }
      \]

\end{enumerate}

\sectionExercice{Implémentation 3D}
\label{exo:impl}

Dans la suite, on va essayer de reproduire une version simplifié du fonctionnement d'Unity. 

\begin{enumerate}
  \item \emph{Implémenter une classe vecteur et matrice adaptées pour la géométrie dans l'espace et les coordonnées homogènes.}

  Pour reprduire uneversion simplifié du moteur Unity, nous avons implémenté une classe \texttt{Vector4} représentant un vecteur à quatre composantes, et sa sous-classe \texttt{HomogeneousVector4} utilisée pour représenter les points en coordonnées homogènes. La classe \texttt{Vector4} fournit une méthode \texttt{multiply\_by\_matrix} permettant de transformer un vecteur par une matrice 4×4.

  Nous avons ensuite défini une classe \texttt{Matrix4x4}, représentant une matrice générique en coordonnées homogènes. Elle inclut une méthode \texttt{prod} pour effectuer le produit matriciel ainsi que les diffréntes transformations : \texttt{translationMatrix4x4}, \texttt{homothetyMatrix4x4} et les méthodes de roation selon les 3 axes x, y et z qui sont suffixe du nom de méthode \texttt{rotationMatrix4x4\_}.  

  Ces nouvelles classes ont été ajoutées à notre bibliothèque Mathy dans \newline \texttt{geometry\_engine\_librairie}. \newline
  

  \item \emph{Implémenter une façon de calculer les coordonnées barycentrique d'un point pour un triangle donné.}

  Le calcul des coordonnées barycentriques d'un triangle est opéré par la fonction \texttt{barycentric\_coordinates}. Cette fonction récupère les coordonnées des sommets \texttt{A, B et C} du triangle et d'un point \texttt{P} quelconque. On applique la règle de de Cramer afin de déterminer les lambdas tels que : \(P = \lambda A * A + \lambda B * B + \lambda C * C, avec \lambda A + \lambda B + \lambda C = 1\).\newline

  \item \emph{Implémenter une classe \texttt{gameobject} qui vous servira de réceptacle pour toutes les informations d'un objet dans votre jeu.}

  La classe \texttt{GameObject} génère des objects du même nom ayant trois attributs : un nom, un objet de la classe \texttt{Transform} définit dans la question suivante ainsi qu'un objet de la class \texttt{Renderer3D} de la question 5. Il contient aussi les différenets données associées aux mesh 3D ainsi que les coordonnées homogènes des vecteurs de l'objet.
  \newline
  

  \item \emph{Implémenter une classe \texttt{transform} qui contiendra les informations de géométries de votre \texttt{gameobject}.}
  

  La classe \texttt{Transform} regroupe les différentes transformations qui seront appliquées à notre objet de la classe \texttt{GameObject} dont le scale anisotrope avec la méthode \texttt{anisotropic\_scale}. \newline 


  \item \emph{Implémenter une classe \texttt{renderer} qui contiendra les informations de rendu de votre \texttt{gameobject}.}

  La classe \texttt{Renderer3D} contient l'application des transformations sur les vecteurs d'un GameObject  
  \newline


  \item \emph{Implémenter un pipeline de rendu simplifié comme vu en cours pour afficher un cube.}
  En se basant sur les classes implémentées précédemment, telles que GameObject, Transform et Renderer, en plus des classes de matrices et vecteurs mises à jour, nous avons créé un système simplifié de pipeline de rendu. Cette dernière peut convertir un ensemble de points sur un espace 3D vers des points projetés sur un espace 2D, plus spécifiquement un écran.

  Elle se divise en 4 parties majeures :

  — Transformation des sommets : Les coordonnées de chaque sommet sont converties d’un espace de coordonnées local vers des coordonnées monde.
  
  — Projection : On détermine où chaque sommet devrait apparaître sur l’écran. Les coordonnées monde du point sont converties en coordonnées de projection, prenant en compte la perspective.
  
  — Rasterisation : Les sommets projetés sont joints pour former des triangles, et les pixels à l’intérieur de ces triangles sont déterminés. C’est ici que l’on calcule quels pixels de l’écran seront affectés par chaque triangle.
  
  — Shading : Pour chaque pixel affecté par un triangle, on détermine la couleur finale à afficher. Cela peut impliquer des calculs de lumière, de texture, etc.\newline
\end{enumerate}

\end{document}
